config {
  type: "table",
  schema: "raw_vault",
  tags: ["link"]
}

SELECT
  MD5(BOOKINGID) AS HK_BOOKINGID,
  MD5(${ref("AI_PASSENGER_DETAILS")}.PASSENGERID) AS HK_PASSENGERID,
  CURRENT_TIMESTAMP() AS LOAD_DTS,
  'AI_AIRPORT_DETAILS' AS REC_SRC
FROM ${ref("AI_BOOKING_DETAILS")}
LEFT JOIN ${ref("AI_PASSENGER_DETAILS")}
ON ${ref("AI_BOOKING_DETAILS")}.PASSENGERID = ${ref("AI_PASSENGER_DETAILS")}.PASSENGERID
WHERE BOOKINGID IS NOT NULL AND ${ref("AI_PASSENGER_DETAILS")}.PASSENGERID IS NOT NULL
GROUP BY BOOKINGID,${ref("AI_PASSENGER_DETAILS")}.PASSENGERID